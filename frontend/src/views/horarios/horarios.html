<div class="horarios-page">
    <!-- Header -->
    <div class="page-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="page-title">
                    <i class="bi bi-calendar3"></i>
                    Gestión de Horarios
                </h1>
                <p class="page-subtitle">Administra los horarios académicos</p>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-primary me-2" ng-click="horariosCtrl.openModal()">
                    <i class="bi bi-plus-circle"></i>
                    Nuevo Horario
                </button>
                <button class="btn btn-outline-secondary me-2" ng-click="horariosCtrl.exportHorarios()">
                    <i class="bi bi-download"></i>
                    Exportar
                </button>
                <button class="btn btn-outline-info" ng-click="horariosCtrl.importHorarios()">
                    <i class="bi bi-upload"></i>
                    Importar
                </button>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="bi bi-funnel"></i>
                Filtros de Búsqueda
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Materia</label>
                    <input type="text" class="form-control" ng-model="horariosCtrl.filters.materia"
                        placeholder="Buscar por materia" ng-change="horariosCtrl.applyFilters()">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Profesor</label>
                    <input type="text" class="form-control" ng-model="horariosCtrl.filters.profesor"
                        placeholder="Buscar por profesor" ng-change="horariosCtrl.applyFilters()">
                </div>
                <div class="col-md-2 mb-3">
                    <label class="form-label">Día</label>
                    <select class="form-select" ng-model="horariosCtrl.filters.dia"
                        ng-change="horariosCtrl.applyFilters()">
                        <option value="">Todos los días</option>
                        <option ng-repeat="dia in horariosCtrl.diasSemana" value="{{ dia.value }}">
                            {{ dia.label }}
                        </option>
                    </select>
                </div>
                <div class="col-md-2 mb-3">
                    <label class="form-label">Hora</label>
                    <input type="time" class="form-control" ng-model="horariosCtrl.filters.hora"
                        ng-change="horariosCtrl.applyFilters()">
                </div>
                <div class="col-md-2 mb-3">
                    <label class="form-label">&nbsp;</label>
                    <button class="btn btn-outline-secondary w-100" ng-click="horariosCtrl.clearFilters()">
                        <i class="bi bi-x-circle"></i>
                        Limpiar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div ng-if="horariosCtrl.loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3 text-muted">Cargando horarios...</p>
    </div>

    <!-- Tabla de Horarios -->
    <div class="card" ng-if="!horariosCtrl.loading">
        <div class="card-header">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-table"></i>
                        Horarios ({{ horariosCtrl.filteredHorarios.length }})
                    </h5>
                </div>
                <div class="col-md-6 text-end">
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-secondary" ng-click="horariosCtrl.previousWeek()">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button class="btn btn-outline-primary" ng-click="horariosCtrl.currentWeek()">
                            Semana Actual
                        </button>
                        <button class="btn btn-outline-secondary" ng-click="horariosCtrl.nextWeek()">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Materia</th>
                            <th>Profesor</th>
                            <th>Día</th>
                            <th>Hora Inicio</th>
                            <th>Hora Fin</th>
                            <th>Aula</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-if="horariosCtrl.filteredHorarios.length === 0">
                            <td colspan="8" class="text-center py-4">
                                <div class="empty-state">
                                    <i class="bi bi-calendar-x"></i>
                                    <h4>No hay horarios</h4>
                                    <p>No se encontraron horarios con los filtros aplicados</p>
                                    <button class="btn btn-primary" ng-click="horariosCtrl.openModal()">
                                        <i class="bi bi-plus-circle"></i>
                                        Crear primer horario
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr ng-repeat="horario in horariosCtrl.filteredHorarios" class="horario-row">
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="materia-icon me-2">
                                        <i class="bi bi-book"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold">{{ horario.materia_nombre }}</div>
                                        <small class="text-muted">{{ horario.descripcion }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="profesor-avatar me-2">
                                        <i class="bi bi-person-circle"></i>
                                    </div>
                                    <span>{{ horario.profesor_nombre }}</span>
                                </div>
                            </td>
                            <td>
                                <span class="badge bg-light text-dark">
                                    {{ horariosCtrl.getDiaLabel(horario.dia_semana) }}
                                </span>
                            </td>
                            <td>
                                <span class="fw-bold">{{ horariosCtrl.formatHora(horario.hora_inicio) }}</span>
                            </td>
                            <td>
                                <span class="fw-bold">{{ horariosCtrl.formatHora(horario.hora_fin) }}</span>
                            </td>
                            <td>
                                <span class="badge bg-info">{{ horario.aula }}</span>
                            </td>
                            <td>
                                <span class="badge" ng-class="'bg-' + horariosCtrl.getEstadoColor(horario.estado)">
                                    {{ horario.estado }}
                                </span>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-primary" ng-click="horariosCtrl.openModal(horario)"
                                        title="Editar">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-danger"
                                        ng-click="horariosCtrl.deleteHorario(horario)" title="Eliminar">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Vista Semanal -->
    <div class="card mt-4" ng-if="!horariosCtrl.loading">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="bi bi-calendar-week"></i>
                Vista Semanal
            </h5>
        </div>
        <div class="card-body">
            <div class="weekly-view">
                <div class="row">
                    <div class="col-md-1">
                        <div class="time-column">
                            <div class="time-header">Hora</div>
                            <div class="time-slot"
                                ng-repeat="hora in ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00']">
                                {{ hora }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1" ng-repeat="dia in horariosCtrl.diasSemana">
                        <div class="day-column">
                            <div class="day-header">{{ dia.label }}</div>
                            <div class="day-slot"
                                ng-repeat="hora in ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00']">
                                <div class="schedule-item"
                                    ng-repeat="horario in horariosCtrl.getHorariosByDay(dia.value)"
                                    ng-if="horario.hora_inicio === hora"
                                    ng-class="'schedule-' + horariosCtrl.getEstadoColor(horario.estado)">
                                    <div class="schedule-title">{{ horario.materia_nombre }}</div>
                                    <div class="schedule-time">{{ horario.hora_inicio }} - {{ horario.hora_fin }}</div>
                                    <div class="schedule-aula">{{ horario.aula }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Crear/Editar Horario -->
    <div class="modal fade" id="horarioModal" tabindex="-1" ng-show="horariosCtrl.showModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi" ng-class="horariosCtrl.editMode ? 'bi-pencil' : 'bi-plus-circle'"></i>
                        {{ horariosCtrl.editMode ? 'Editar' : 'Nuevo' }} Horario
                    </h5>
                    <button type="button" class="btn-close" ng-click="horariosCtrl.closeModal()"></button>
                </div>
                <form ng-submit="horariosCtrl.saveHorario()">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Materia *</label>
                                <select class="form-select" ng-model="horariosCtrl.horarioForm.materia_id" required>
                                    <option value="">Seleccionar materia</option>
                                    <option ng-repeat="materia in horariosCtrl.materias" value="{{ materia.id }}">
                                        {{ materia.nombre }}
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Profesor *</label>
                                <select class="form-select" ng-model="horariosCtrl.horarioForm.profesor_id" required>
                                    <option value="">Seleccionar profesor</option>
                                    <option ng-repeat="profesor in horariosCtrl.profesores" value="{{ profesor.id }}">
                                        {{ profesor.nombre }} {{ profesor.apellido }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Día de la semana *</label>
                                <select class="form-select" ng-model="horariosCtrl.horarioForm.dia_semana" required>
                                    <option value="">Seleccionar día</option>
                                    <option ng-repeat="dia in horariosCtrl.diasSemana" value="{{ dia.value }}">
                                        {{ dia.label }}
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Hora de inicio *</label>
                                <input type="time" class="form-control" ng-model="horariosCtrl.horarioForm.hora_inicio"
                                    required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Hora de fin *</label>
                                <input type="time" class="form-control" ng-model="horariosCtrl.horarioForm.hora_fin"
                                    required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Aula *</label>
                                <input type="text" class="form-control" ng-model="horariosCtrl.horarioForm.aula"
                                    placeholder="Ej: Aula 101" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-select" ng-model="horariosCtrl.horarioForm.estado">
                                    <option ng-repeat="estado in horariosCtrl.estados" value="{{ estado.value }}">
                                        {{ estado.label }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripción</label>
                            <textarea class="form-control" ng-model="horariosCtrl.horarioForm.descripcion" rows="3"
                                placeholder="Descripción opcional del horario"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" ng-click="horariosCtrl.closeModal()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary" ng-disabled="horariosCtrl.loading">
                            <span ng-if="horariosCtrl.loading" class="spinner-border spinner-border-sm me-2"></span>
                            <i ng-if="!horariosCtrl.loading" class="bi"
                                ng-class="horariosCtrl.editMode ? 'bi-check' : 'bi-plus'"></i>
                            {{ horariosCtrl.loading ? 'Guardando...' : (horariosCtrl.editMode ? 'Actualizar' : 'Crear')
                            }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>